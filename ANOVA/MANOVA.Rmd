---
title: "MANOVA"
author: "P-Value Analitics"
date: "2/25/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries
```{r, warning=FALSE, message=FALSE}
pacman::p_load(tidyverse, rstatix, effectsize)
```

# Uploading data from the computer
```{r, warning=FALSE, message=FALSE}
Data <- read_csv('C:\\Tom\\pvalue\\2021\\2\\R course\\Data.csv')
```


# Preparing data
```{r, warning=FALSE, message=FALSE}
unitedData <- Data %>% 
  drop_na(ID, Gender, Score, Stage, Age, monthlyGameEntry, Purchase, monthlyIncome, Month) %>% 
  group_by(ID, Gender, Age) %>% 
  summarise(meanScore = mean(Score),
            meanStage = mean(Stage),
            meanmonthlyGameEntry = mean(monthlyGameEntry),
            meanPurchase = mean(Purchase),
            meanmonthlyIncome = mean(monthlyIncome))
```

# Assumptions and preleminary tests
## Adequate sample size. Rule of thumb: the n in each cell > the number of outcome variables.
```{r, warning=FALSE, message=FALSE}
unitedData %>% 
  group_by(Gender) %>% 
  summarise(NScore = length(meanScore),
            NStage = length(meanStage),
            NmonthlyGameEntry = length(meanmonthlyGameEntry),
            NPurchase = length(meanPurchase),
            NmonthlyIncome = length(meanmonthlyIncome)) %>% 
  summarise(NScore > ncol(unitedData) - 1,
         NStage > ncol(unitedData) - 1,
         NmonthlyGameEntry > ncol(unitedData) - 1,
         NPurchase > ncol(unitedData) - 1,
         NmonthlyIncome > ncol(unitedData) - 1)
```

## Check univariate normality assumption - all p-values greater than 0.05
```{r, warning=FALSE, message=FALSE}
unitedData %>%
  group_by(Gender) %>%
  shapiro_test(meanScore, meanStage, Age, meanmonthlyGameEntry, meanPurchase, meanmonthlyIncome) 
```


## Multivariate normality - p-values greater than 0.05
```{r, warning=FALSE, message=FALSE}
unitedData[, c('meanScore', 'meanStage', 'Age', 'meanmonthlyGameEntry', 'meanPurchase', 'meanmonthlyIncome')] %>%
  mshapiro_test()
```

## Identify multicollinearity and check linearity assumption - Sgnificant correlations with the same directions smaller than 0.9
```{r, warning=FALSE, message=FALSE}
unitedData[, c('meanScore', 'meanStage', 'Age', 'meanmonthlyGameEntry', 'meanPurchase', 'meanmonthlyIncome')] %>%
  cor_test()
```

## Check the homogeneity of covariances assumption - p-values greater than 0.01
```{r, warning=FALSE, message=FALSE}
box_m(unitedData[, c('meanScore', 'meanStage', 'Age', 'meanmonthlyGameEntry', 'meanPurchase', 'meanmonthlyIncome')], unitedData$Gender)
```

## Variances equality - p-values greater than 0.05
```{r, warning=FALSE, message=FALSE}
grouped.data <- unitedData %>%
  gather(key = "variable", value = "value", meanScore, meanStage, Age, meanmonthlyGameEntry, meanPurchase, meanmonthlyIncome) %>%
  group_by(variable)

 grouped.data %>%
  levene_test(value ~ Gender)
```

# Hypothesis confirming
```{r, warning=FALSE, message=FALSE}
Model <- lm(cbind(meanScore, meanStage, Age, meanmonthlyGameEntry, meanPurchase, meanmonthlyIncome) ~ Gender, unitedData)
Manova(Model, test.statistic = "Pillai")
```

# Univariante analyses
## Two levels: Independet sample t-tests
```{r, warning=FALSE, message=FALSE}
Model <- grouped.data %>% t_test(value ~ Gender, var.equal = FALSE)
```

## Effect size one example
```{r, warning=FALSE, message=FALSE}
Model <- t.test(meanScore ~ Gender, data = unitedData, var.equal = TRUE)
effectsize(Model)
```

## Three levels or more: One ways ANOVA
```{r, warning=FALSE, message=FALSE}
grouped.data %>% anova_test(value ~ Gender)
```

### Post hoc comparisons
```{r, warning=FALSE, message=FALSE}
# grouped.data %>% 
  # pairwise.t.test(value ~ Gender, var.equal = FALSE, p.adjust.method = 'BH', pool.sd = FALSE)
```
